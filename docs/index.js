!function(t){var e={};function n(a){if(e[a])return e[a].exports;var s=e[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(a,s,function(e){return t[e]}.bind(null,s));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(t,e){function n(t){return t*Math.PI/180}t.exports={simple:(t,e)=>e.map(e=>(e.distance=Math.sqrt(Math.pow(e.latitude-t.latitude,2)+Math.pow(e.longitude-t.longitude,2)),e)),haversine:(t,e)=>e.map(e=>{const a=n(t.latitude),s=n(e.latitude),o=n(t.longitude),i=n(e.longitude),r=n(e.latitude-t.latitude),l=n(e.longitude-t.longitude),c=Math.sin(r/2)*Math.sin(r/2)+Math.cos(a)*Math.cos(s)*Math.sin(l/2)*Math.sin(l/2),d=6371e3*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)));e.distance=d;const u=Math.sin(i-o)*Math.cos(s),h=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-o),p=180*Math.atan2(u,h)/Math.PI;return e.bearing=p,e}),human:t=>void 0===t?"Onbekend":t>1e4?Math.round(t/1e3)+" km":t>1e3?Math.round(t/100)/10+" km":t+" m"}},function(t,e,n){const a=n(2),s=n(0),o="http://paaldb.timendus.com/api";async function i(){let t=a.get("locationTimestamp"),e=a.get("locations");if(e&&(e=JSON.parse(e)),!e||t<new Date-6e5){try{e=await r(`${o}/locations`)}catch(t){throw t}a.store("locations",JSON.stringify(e)),a.store("locationTimestamp",1*new Date)}return e}async function r(t){try{const e=await fetch(t,{headers:{"Content-Type":"application/json"}});if(e.ok)return await e.json();throw`PaalDB returned error status: ${e.status}`}catch(t){throw`Could not reach PaalDB: ${t}`}}t.exports={allLocations:()=>i(),location:t=>r(`${o}/locations/${t}`),getNearest:async(t,e,n)=>{let a;try{a=await i()}catch(t){throw t}return s.haversine({latitude:t,longitude:e},a).sort((t,e)=>t.distance-e.distance).slice(0,n)}}},function(t,e){t.exports={store:(t,e)=>localStorage.setItem(t,e),get:t=>localStorage.getItem(t)}},function(t,e,n){const a=n(2);t.exports={available:()=>!!navigator.geolocation,get:async()=>{let t=a.get("geolocation");if(t)return JSON.parse(t);try{t=await new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(e=>{t(e)},t=>{e(t)})})}catch(t){throw t}return t={timestamp:t.timestamp,latitude:t.coords.latitude,longitude:t.coords.longitude,altitude:t.coords.altitude},a.store("geolocation",JSON.stringify(t)),t},reset:()=>{a.store("geolocation",null)}}},function(t,e){let n;t.exports={listen:()=>{window.addEventListener("beforeinstallprompt",t=>{n=t,t.preventDefault(),console.log("We can install!")}),"serviceWorker"in navigator&&navigator.serviceWorker.register("service_worker.js"),console.log("Done")},install:async()=>{n.prompt(),"accepted"===(await n.userChoice).outcome?console.log("Accepted!"):console.log("Rejected"),n=null}}},function(t,e,n){const a=n(1),s=n(3),o=n(0);t.exports={render:async()=>{try{let t;if(s.available()){const e=await s.get();t=await a.getNearest(e.latitude,e.longitude,15)}else t=(await a.allLocations()).slice(0,10);return function(t){return`\n    <header>\n      \x3c!--<span class='left'>Logo hier</span>--\x3e\n      <h1>Bij de Paal</h1>\n    </header>\n\n    <ul class='location-list'>\n      ${t.length>0?t.map(t=>`\n          <li>\n            <a href='#location/${t.id}'>\n              <span class='name'>${t.name}</span>\n              ${t.distance&&t.bearing?`\n                  <span class='direction'>\n                    <span class='distance'>${o.human(t.distance)}</span>\n                    <span class='bearing' style='display: inline-block; transform: rotate(${t.bearing}deg)'>↑</span>\n                  </span>\n                `:""}\n            </a>\n          </li>\n        `).join(""):"<li>Empty</li>"}\n    </ul>\n  `}(t)}catch(t){throw t}}}},function(t,e,n){const a=n(1),s=n(3),o=n(0);t.exports={render:async t=>{try{let e=await a.location(t);return s.available()&&([e]=o.haversine(await s.get(),[e])),function(t){return`\n    <header>\n      <span class='left'><a class='back' href='#list'></a></span>\n      <h1>${t.name}</h1>\n    </header>\n\n    <div class='location-details'>\n\n      ${t.distance&&t.bearing?`\n          <p class='direction'>\n            Afstand:\n            <span class='distance'>${o.human(t.distance)}</span>\n            <span class='bearing' style='display: inline-block; transform: rotate(${t.bearing}deg)'>↑</span>\n          </p>\n        `:""}\n\n      <ul class='maps'>\n        <li><a href='https://maps.google.com/?q=${t.latitude},${t.longitude}' target='_blank'><img src='images/google-maps.png'/></a></li>\n        <li><a href='https://maps.apple.com/?q=${t.latitude},${t.longitude}' target='_blank'><img src='images/apple-maps.png'/></a></li>\n      </ul>\n\n      ${t.fireHazard?`<p class='fire-hazard'>Brandrisico: ${t.fireHazard}</p>`:""}\n\n      <p>Deze locatie wordt vermeld door ${t.Mentions.map(t=>t.Source.name).join(", ")}.</p>\n    </div>\n  `}(e)}catch(t){throw t}}}},,function(t,e,n){"use strict";n.r(e);class a{constructor(){this._handlers={},document.addEventListener("click",t=>this._callHandler("click",t)),document.addEventListener("mousedown",t=>this._callHandler("mousedown",t)),document.addEventListener("mouseup",t=>this._callHandler("mouseup",t))}register(t,e={click:null,mousedown:null,mouseup:null}){"function"==typeof e&&(e={click:e}),this._handlers[t]=this._handlers[t]||[],this._handlers[t].push(e)}_callHandler(t,e){Object.keys(this._handlers).forEach(n=>{if(null!==e.target.closest(n)){this._handlers[n].map(e=>e[t]).forEach(t=>{"function"!=typeof t||e.defaultPrevented||t(e,n)})}})}}a.instance=function(){return a._instance?a._instance:a._instance=new a};var s=a;class o{constructor(t="dragging"){this._dragClass=t,this._handlers={},document.addEventListener("dragover",t=>this._dragOver(t)),document.addEventListener("dragleave",t=>this._dragLeave(t)),document.addEventListener("drop",t=>this._drop(t))}register(t,e){this._handlers[t]=e,s.instance().register(t,(t,e)=>this._openFileDialog(t,e))}_dragOver(t){this._isDropTarget(t.target)&&(t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy",t.target.classList.add(this._dragClass))}_dragLeave(t){this._isDropTarget(t.target)&&(t.stopPropagation(),t.preventDefault(),t.target.classList.remove(this._dragClass))}_drop(t){let e=this._isDropTarget(t.target);e&&(t.stopPropagation(),t.preventDefault(),t.target.classList.remove(this._dragClass),this._handleFile(e,t,t.dataTransfer.files[0]))}_isDropTarget(t){return Object.keys(this._handlers).find(e=>{if(t.closest(e))return e})||!1}_openFileDialog(t,e){const n=document.createElement("input");n.type="file",n.addEventListener("change",n=>this._handleFile(e,t,n.target.files[0])),n.click()}_handleFile(t,e,n){this._readFile(n).then(a=>this._handlers[t](n,a,e))}_readFile(t){return new Promise((e,n)=>{var a=new FileReader;a.addEventListener("load",t=>e(t.target.result)),a.readAsDataURL(t)})}}o.instance=function(){return o._instance?o._instance:o._instance=new o};const i={Click:s,FileTarget:o,Router:class{constructor(){this._routes=[],s.instance().register("a[href]",t=>this._handleClick(t)),window.addEventListener("hashchange",t=>this._handleNavigationEvent(t)),window.addEventListener("load",t=>this._handleNavigationEvent(t))}addRoute(t,e){this._routes.push([t,e])}addRoutes(t,e=null){Array.isArray(t)?t.forEach(t=>this.addRoute(t,e)):Object.keys(t).forEach(e=>this.addRoute(e,t[e]))}_handleClick(t){let e=t.target.getAttribute("href");this._matchingLink(e)&&(window.location.hash=e,t.preventDefault())}_handleNavigationEvent(t){let e=window.location.hash;if(!(e=this._matchingLink(e)))return;let n=e.route[1];n&&n(e.route[0],e.matches,t)}_matchingLink(t){if(!t)return!1;if("#"==!t.substr(0,1))return!1;for(const e of this._routes)if(e[0]instanceof RegExp){const n=t.substr(1).match(e[0]);if(n)return{route:e,matches:n}}else if(e[0]==t.substr(1))return{route:e,matches:null};return!1}},Energize:class{constructor(t,e={}){this._scope=t,this._options=this._normalizeOptions(e),s.instance().register(`${t} [${this._options.open}], ${t} [${this._options.close}], ${t} [${this._options.toggle}]`,t=>this._handleClick(t))}_normalizeOptions(t){return Object.assign({class:"active",open:"data-open",close:"data-close",toggle:"data-toggle",group:"data-group",timer:"data-timer",follower:"data-follower"},t)}_handleClick(t){const e=t.target.closest(`[${this._options.open}], [${this._options.close}], [${this._options.toggle}]`),n=e.getAttribute(this._options.close),a=e.getAttribute(this._options.open),s=e.getAttribute(this._options.toggle);let o=n?document.querySelectorAll(`${this._scope} ${n}`):[],i=a?document.querySelectorAll(`${this._scope} ${a}`):[];o=[...o,...s?document.querySelectorAll(`${this._scope} ${s}.${this._options.class}`):[]],i=[...i,...s?document.querySelectorAll(`${this._scope} ${s}:not(.${this._options.class})`):[]],this._close(o),this._open(i),t.preventDefault(),t.stopPropagation()}_close(t){t.forEach(t=>{t.classList.remove(this._options.class),this._close(this._followers(t))})}_open(t){t.forEach(t=>{this._close(this._group(t)),t.classList.add(this._options.class),this._open(this._followers(t));const e=t.getAttribute(this._options.timer);e&&window.setTimeout(()=>this._close([t]),e)})}_group(t){const e=t.getAttribute(this._options.group);return e?[...document.querySelectorAll(`${this._scope} [${this._options.group}=${e}]`)]:[]}_followers(t){const e=t.getAttribute(this._options.follower);return e?[...document.querySelectorAll(`${this._scope} ${e}`)]:[]}}};var r=i;window.Thimbleful=i;const l=new r.Router;function c(t){const e=document.getElementById("error");e.innerHTML=t,e.classList.add("active")}n(4).listen(),l.addRoute("list",async(t,e,a)=>{try{const t=n(5);document.getElementById("app").innerHTML=await t.render()}catch(a){c(a)}}),l.addRoute(/location\/(.+)/,async(t,e)=>{try{const t=n(6);document.getElementById("app").innerHTML=await t.render(e[1])}catch(t){c(t)}}),window.addEventListener("load",()=>{window.location.hash||(window.location.hash="list")})}]);